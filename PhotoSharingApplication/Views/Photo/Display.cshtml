@model PhotoSharingApplication.Models.ViewModels.PhotoDisplayViewModel
@{
    ViewBag.Title = Model.Photo.Title;
}

<div class="row g-4">
    <div class="col-12 col-lg-8">
        <div class="card hero-card">
            <img class="hero-img" src="@Url.Action("GetImage","Photo", new { id = Model.Photo.PhotoID })" alt="@Model.Photo.Title" />
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                    <div>
                        <h1 class="h4 mb-1">@Model.Photo.Title</h1>
                        <div class="text-muted small d-flex flex-wrap gap-2">
                            <span class="badge badge-soft rounded-pill">by @Model.Photo.UserName</span>
                            <span class="badge text-bg-light rounded-pill">@Model.Photo.CreatedDate.ToString("yyyy-MM-dd")</span>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <a class="btn btn-outline-secondary btn-sm" href="@Url.Action("Index","Photo")">Back</a>
                        <a class="btn btn-outline-danger btn-sm" href="@Url.Action("Delete","Photo", new { id = Model.Photo.PhotoID })">Delete</a>
                    </div>
                </div>

                @if (!string.IsNullOrWhiteSpace(Model.Photo.Description))
                {
                    <p class="mt-3 mb-0">@Model.Photo.Description</p>
                }
                else
                {
                    <p class="mt-3 mb-0 text-muted">No description.</p>
                }
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h2 class="h6 mb-3">Add a comment</h2>

                @using (Html.BeginForm("AddComment", "Photo", new { id = Model.Photo.PhotoID }, FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                    @Html.HiddenFor(m => m.NewComment.PhotoID)

                    <div class="mb-2">
                        <label class="form-label">Your name</label>
                        @Html.TextBoxFor(m => m.NewComment.UserName, new { @class = "form-control", placeholder = "Anonymous" })
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Subject</label>
                        @Html.TextBoxFor(m => m.NewComment.Subject, new { @class = "form-control", placeholder = "Nice shot!" })
                        @Html.ValidationMessageFor(m => m.NewComment.Subject, "", new { @class = "text-danger small" })
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Comment</label>
                        @Html.TextAreaFor(m => m.NewComment.Body, 4, 40, new { @class = "form-control", placeholder = "Write something..." })
                    </div>

                    <button class="btn btn-success w-100" type="submit">Post comment</button>
                }
            </div>
        </div>

        <div class="mt-4">
            <h2 class="h6 mb-3">Comments (@(Model.Comments == null ? 0 : Model.Comments.Count))</h2>

            @if (Model.Comments == null || Model.Comments.Count == 0)
            {
                <div class="text-muted small">No comments yet.</div>
            }
            else
            {
                foreach (var c in Model.Comments)
                {
                    <div class="card mb-2 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="fw-semibold">@c.Subject</div>
                                <div class="small text-muted">@c.UserName</div>
                            </div>
                            @if (!string.IsNullOrWhiteSpace(c.Body))
                            {
                                <div class="small text-muted mt-2">@c.Body</div>
                            }
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>
